Index: kernel/includes/smarty/plugins/_inc.fisheye.2.php
===================================================================
--- kernel/includes/smarty/plugins/_inc.fisheye.2.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/_inc.fisheye.2.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,19 +0,0 @@
-<style><!--
-.h{font-size:20px} .q{color:#00c} 
-#imageTitle span {background: white}
- .Separator {width: 1px; height: 35px; border-right: 1px solid #D0D0D0; margin-left: 8px}
---></style><script type="text/javascript">k=document;v=Date;x=false;z=Array;af=Math.floor;ag=RegExp;b=new z(12);saa=new z("null",<?=$appIdsStr;?>);aa=new z(11);ab=10;t=0;u=0;n=0;o=new v();h=5;m=385;c=0;w=x;var title;var firstHoverOccurred=x;m=385;p=0;function d(ac){c=ac;o=new v();setTimeout("gidle()",20);}function e(ac){c=0;w=x;o=new v();setTimeout("gidle()",20);}function ae(){for(var j=1;j<b.length;j++){b[j]=35}title=k.getElementById('imageTitle');for(i=0;i<b.length;i++){aa[i]=new Image();aid=saa[i+1];aa[i].src="../../../"+ aid + "/html/img/" + saa[i+1]+".gif"}setTimeout("gidle()",20);}function gidle(){var l=0;for(var i=1;i<b.length;i++){var imagename="image"+i;var imageElem=k.getElementById(imagename);if(c!=i){if(b[i]>35){b[i]-=h;if(b[i]<=35){b[i]=35;aid=saa[i];imageElem.src="../../../"+ aid + "/html/img/" + saa[i]+"35.gif"}imageElem.width=b[i];imageElem.height=b[i];if(c==0){var g=af(255-255*(b[i]-35)/35);title.style.visibility="hidden";title.style.color="rgb("+g+","+g+","+g+")"}p=1}l+=b[i]}}if(c!=0&&b[c]<100){imagename="image"+c;imageElem=k.getElementById(imagename);if(w==x){w=true;var y=(c-1)*45;title.innerHTML='<img src="../../../common/html/res/images/cleardot.gif" width=' + y + ' height=1><span>' + k.getElementById(imagename).alt+'</span>'}b[c]+=h;p=1;if(b[c]>100){b[c]=100}l+=b[c];if(l<m){b[c]+=m-l;if(b[c]>100){b[c]=100}l=m}var g=af(255-255*(b[c]-35)/35);title.style.visibility="visible";title.style.color="rgb("+g+","+g+","+g+")";imageElem.width=b[c];imageElem.height=b[c];aid=saa[c];k.getElementById(imagename).src="../../../"+ aid + "/html/img/" + saa[c]+".gif"}m=l;var ad=new v();ab=ad.getTime()-o.getTime();o=ad;t+=ab;u++;n=t/u;h=5;if(u>4){if(n>30){h=10}if(n>60){h=15}if(n>90){h=20}}if(p){setTimeout("gidle()",20);p=0}}</script>
-</script>
-
-	
-<div style='position: absolute; bottom: 5px; padding-left: 2px; '>
-<table><tr><td id="imageTitle" style="color: rgb(255, 255, 255); font-weight: bold; white-space: nowrap" >&nbsp;</td></tr></table>
-<table style='float:left'><tr height="35" valign='bottom'><td>
-	<?=$footerContent;?>
-</td>
-<? if ($needAddServiceLink) { ?><td valign='bottom' nowrap style='padding-bottom: 10px'><a href='<?=$addServiceLink?>'><?=$kernelStrings["app_add_remove_services"];?></a></td><? } ?>
-</tr></table>
-</div>
-<script>
-	ae ();
-</script>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/_inc.fisheye.old.php
===================================================================
--- kernel/includes/smarty/plugins/_inc.fisheye.old.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/_inc.fisheye.old.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,16 +0,0 @@
-<script type="text/javascript">
-	var appsArray = new Array ("null",<?=$appIdsStr;?>);
-</script>	
-<script type="text/javascript" src='../../../common/html/cssbased/layout/topmenu/fisheye.js'></script>
-	
-<div style='position: absolute; bottom: 5px; padding-left: 2px; '>
-<table style='display:none' id="titleTable" ><tr><td id="imageTitle" style="color: rgb(255, 255, 255); font-weight: bold; white-space: nowrap" >&nbsp;</td></tr></table>
-<table style='float:left'><tr height="35" valign='bottom'><td>
-	<?=$footerContent;?>
-</td>
-<? if ($needAddServiceLink) { ?><td valign='bottom' nowrap style='padding-bottom: 10px'><a href='<?=$addServiceLink?>'><?=$kernelStrings["app_add_remove_services"];?></a></td><? } ?>
-</tr></table>
-</div>
-<script>
-	ae ();
-</script>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/block.pd_shareJavaScriptCode.php
===================================================================
--- kernel/includes/smarty/plugins/block.pd_shareJavaScriptCode.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/block.pd_shareJavaScriptCode.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,575 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     block
- * Name:     pd_shareJavaScriptCode
- * Purpose:  Print javascript code 
- * -------------------------------------------------------------
- */
-
-function smarty_block_pd_shareJavaScriptCode( $params, $content, &$smarty, &$repeat ) {
-    global $currentUser;
-    $countFiles = count($params["filesList"]);
-    $pdStrings = $smarty->get_template_vars('pdStrings');
-    $result = '
-        <script>
-            var currentShowPicture = 0;
-            var allFiles = '.$countFiles.';
-            var isPlayStart = false;
-            var interval = 0;
-            var delay = 0;
-            var isNextFileLoading = false;
-            var firstLoad = false;
-            var isControlsFrosen = false;
-            
-            // pagination
-            
-            var curThumbsPage = 0;
-            var thumbsPerPage = '.PD_SLIDESHOW_DEFAULT_THUMBS_COUNT.';
-            var maxThumbsPage = '.floor(($countFiles - 1) / PD_SLIDESHOW_DEFAULT_THUMBS_COUNT).';
-            //alert(maxThumbsPage);
-            
-            function getImage(n) {
-                this.num = n;
-        		
-        		this.tick = function() {
-            		var req = new Subsys_JsHttpRequest_Js();
-            		var obj = this;
-            
-            		req.onreadystatechange = function() {
-            			if (req.readyState == 4){
-            				if (req.responseJS){
-            					if ( req.responseJS.state == "OK" ) {
-            					    var im = document.getElementById("img_" + obj.num);
-            					    var imDiv = document.getElementById("image_" + obj.num);
-            					    im.src = req.responseJS.responseText;
-            					    imDiv.setAttribute("emptyfile", 0);
-            					    im.onload = function () {
-            					        //pd_shareChangePicture(this.getAttribute("num"), 1);
-            					        pd_shareChangeImage(this.getAttribute("num"));
-            					    }
-            					}
-            					if ( req.responseJS.error != "" ) {
-            						alert( req.responseJS.error );
-            					}
-            				}
-            			}
-            		}
-            		
-            		req.open("GET", "getimageurl.php", true);
-            		req.send( { NUM: this.num, IMG_SIZE: currentThumbSize, XUSER: '.($currentUser ? '1' : '0').' } );
-        		}
-        	}
-        	
-        	function changeImagesSize(size) {
-        	    currentThumbSize = size;
-        	    for (i = 0; i < '.$countFiles.'; i ++) {
-                    var nextImgDiv = document.getElementById("image_" + i);
-                    nextImgDiv.setAttribute("emptyfile", 1);
-                }
-                var mainDesk = document.getElementById("mainDesk");
-                
-                if (size == '.PD_LARGE_THUMB_SIZE.') {
-                    mainDesk.setAttribute("width", '.PD_LARGE_THUMB_SIZE.');
-                    mainDesk.setAttribute("height", '.PD_LARGE_THUMB_SIZE.');
-                }
-                else {
-                    mainDesk.setAttribute("width", 800);
-                    mainDesk.setAttribute("height", '.PD_MEDIUM_THUMB_SIZE.');
-                }
-                pd_shareChangeImage(currentShowPicture);
-        	}
-        	
-        	function getThumbnailPanel(page) {
-                this.page = page;
-        		
-        		this.tick = function() {
-            		var req = new Subsys_JsHttpRequest_Js();
-            		var obj = this;
-            
-            		req.onreadystatechange = function() {
-            			if (req.readyState == 4) {
-            				if (req.responseJS) {
-            					if ( req.responseJS.state == "OK" ) {
-            					    //alert(req.responseJS.responseText);
-            					    if (req.responseJS.responseText) {
-            					        var thumbsPanel = document.getElementById("thumbsPanel");
-            					        thumbsPanel.innerHTML = req.responseJS.responseText;
-            					        pd_shareChangeImage(currentShowPicture);
-            					        pd_markThumbnail(currentShowPicture);
-            					    }
-            					}
-            					if ( req.responseJS.error != "" ) {
-            						alert( req.responseJS.error );
-            					}
-            				}
-            			}
-            		}
-            		
-            		req.open("GET", "getthumbpanel.php", true);
-            		req.send( { PAGE: this.page } );
-        		}
-        	}
-            
-            function pd_shareTemplateInit() {
-                try {
-                    //var imgDiv = document.getElementById("bigImageDiv");
-                    //var canvasWidth = imgDiv.offsetWidth;
-                    //var canvasHeight = imgDiv.offsetHeight;
-                    //var imgDivPos = xs_getAbsolutePos(imgDiv);
-                    
-                    for (i = 0; i < '.$countFiles.'; i ++) {
-                        var nextImgDiv = document.getElementById("image_" + i);
-                        
-                        /*
-                        var rg, res;
-                        rg = new RegExp("^([0-9]+)px$", "i");
-                        res = rg.exec(nextImgDiv.style.width);
-                        var offX = (canvasWidth / 2) - (res[1] / 2);
-                        
-                        res = rg.exec(nextImgDiv.style.height);
-                        var offY = (canvasHeight / 2) - (res[1] / 2);
-                        */
-                        
-                        //xs_setAbsolutePosition(nextImgDiv, imgDivPos.x + offX, imgDivPos.y + offY);
-                        //xs_setAbsolutePosition(nextImgDiv, imgDivPos.x, imgDivPos.y);
-                        
-                        if (i == 0) {
-                            nextImgDiv.style.display = ""; 
-                        }
-                    }
-                    
-                    //if (!firstLoad) {
-                        if (currentShowPicture == 0) { 
-                            pd_changeThumbPage(curThumbsPage);                   
-                            firstLoad = true;
-                        }
-                    //}
-                }
-                catch(e){
-                }    
-            }
-            
-            function checkPageListers() {
-                var el1 = document.getElementById("prevSel");
-                var el2 = document.getElementById("nextSel");
-                
-                if (el1 && el2) {
-                    el1.style.display = "block";
-                    el2.style.display = "block";
-                    
-                    if (curThumbsPage == 0) {
-                        el1.style.display = "none";
-                    }
-                    if (curThumbsPage == maxThumbsPage) {
-                        el2.style.display = "none";
-                    }
-                }
-            }
-            
-            function pd_changeThumbPage(page) {
-                var listTo = parseInt(page);
-                curThumbsPage += listTo;
-                if (curThumbsPage < 0) {
-                    curThumbsPage = 0;
-                    return;
-                }
-                if (curThumbsPage > maxThumbsPage) {
-                    curThumbsPage = maxThumbsPage;
-                    return;
-                }
-                
-                if (listTo >= 0) {
-                    currentShowPicture = curThumbsPage * (thumbsPerPage - 1);
-                }
-                else {
-                    var t = thumbsPerPage - 1;
-                    currentShowPicture = (curThumbsPage * t) + t;
-                }
-		        if (currentShowPicture < 0) currentShowPicture = 0;
-		        
-		        checkPageListers();
-		        
-                var tp = new getThumbnailPanel(curThumbsPage);
-                tp.tick();
-            }
-            
-            function goFirst() {
-                curThumbsPage = 0;
-                currentShowPicture = 0;
-                
-                checkPageListers();
-                
-                var tp = new getThumbnailPanel(curThumbsPage);
-                tp.tick();
-            }
-            
-            function goLast() {
-                curThumbsPage = maxThumbsPage;
-                currentShowPicture = allFiles - 1;
-                
-                checkPageListers();
-                
-                var tp = new getThumbnailPanel(curThumbsPage);
-                tp.tick();
-            }
-            
-            function pd_shareShowPopUpThumb(n) {
-                //var curThumb = document.getElementById("thumb1_div_" + n);
-                //curThumb.style.display = "";
-            }
-            
-            function pd_shareClosePopUpThumb(n) {
-                //var curThumb = document.getElementById("thumb1_div_" + n);
-                //curThumb.style.display = "none";
-            }
-            
-            function pd_markThumbnail(n) {
-                var cur = document.getElementById("thumb2_div_" + n);
-                
-                if (cur != null) {
-                    cur.style.cssText = "border: 2px solid #FFFF00;";
-                }
-            }
-            
-            function pd_unmarkThumbnail(n) {
-                var cur = document.getElementById("thumb2_div_" + n);
-                
-                if (cur != null) {
-                    cur.style.cssText = "border: 2px solid #FFFFFF;";
-                }
-            }
-            
-            function pd_clearAllNotShow() {
-                var curImgDiv;
-                var curImgTitle;
-                for (i = 0; i < '.$countFiles.'; i ++) {
-                    var curImgDiv = document.getElementById("image_" + i);
-                    var curImgTitle = document.getElementById("fileDesc_" + i);
-                    curImgDiv.style.display = "none";
-                    curImgTitle.style.display = "none";
-                }
-            }
-            
-            function pd_shareChangeImage(n) {
-                if (!isPlayStart) {
-                    froseControls(true);
-                }
-                
-                var imDiv = document.getElementById("image_" + n);
-                var emptyFile = imDiv.getAttribute("emptyfile");
-                if (emptyFile == 1) {
-                    if (isPlayStart) {
-                        clearInterval(interval); 
-                        isNextFileLoading = true;
-                    }
-                    
-                    var im = new getImage(n);
-                    im.tick();
-                    return;
-                }
-                
-                if (isNextFileLoading && isPlayStart && delay) {
-                    interval = setInterval("goToImage(1);", delay * 1000);
-                }
-                isNextFileLoading = false;
-                
-                pd_clearAllNotShow();
-                
-                var curImgDiv = document.getElementById("image_" + currentShowPicture);
-                var curImgTitle = document.getElementById("fileDesc_" + currentShowPicture);
-                
-                var newImgDiv = document.getElementById("image_" + n);
-                var newImgTitle = document.getElementById("fileDesc_" + n);
-                
-                curImgDiv.style.display = "none";
-                curImgTitle.style.display = "none";
-                
-                newImgDiv.style.display = "block";
-                newImgTitle.style.display = "block";
-                
-                pd_unmarkThumbnail(currentShowPicture);
-                pd_markThumbnail(n);
-                
-                currentShowPicture = n;
-                
-                if (!isPlayStart) {
-                    froseControls(false);
-                }
-            }
-            
-            /*function pd_shareChangePicture(n, effect, ignoreN) {
-                
-                if (ignoreN == null) ignoreN = true;
-                
-                
-                if (!ignoreN) {
-                    if (n == currentShowPicture) return;
-                }
-                
-                froseControls(true);
-                
-                var imDiv = document.getElementById("image_" + n);
-                var emptyFile = imDiv.getAttribute("emptyfile");
-                if (emptyFile == 1) {
-                    if (isPlayStart) {
-                        clearInterval(interval); 
-                        isNextFileLoading = true;
-                    }
-                    
-                    var im = new getImage(n, ignoreN);
-                    im.tick();
-                    return;
-                }
-
-                if (isNextFileLoading && isPlayStart && delay) {
-                    interval = setInterval("goToImage(1);", delay * 1000);
-                }
-                isNextFileLoading = false;
-                
-                var curImgDiv = document.getElementById("image_" + currentShowPicture);
-                var curImgTitle = document.getElementById("fileDesc_" + currentShowPicture);
-                
-                var newImgDiv = document.getElementById("image_" + n);
-                var newImgTitle = document.getElementById("fileDesc_" + n);
-                
-                //newImgDiv.style.display = "block";
-
-                if (!ignoreN) {
-                    if (!effect || (effect == 1)) {
-                        pd_shareShowEffect1("image_" + currentShowPicture, "image_" + n, 1);
-                    }
-                    
-                    curImgDiv.style.display = "none";
-                    curImgTitle.style.display = "none";
-                    newImgTitle.style.display = "block";
-                    
-                    pd_markThumbnail(n);
-                    pd_unmarkThumbnail(currentShowPicture);
-                }
-                else {
-                    curImgTitle.style.display = "none";
-                    newImgDiv.style.display = "block";
-                    newImgTitle.style.display = "block";
-                }
-                                
-                currentShowPicture = n;
-                
-                froseControls(false);
-            }*/
-            
-            function pd_shareShowEffect1(from, to, start) {
-                // Detect IE Browser (see file xsystem.js)
-                if (start <= 0) return;
-                var fr = document.getElementById(from);
-                var t = document.getElementById(to);
-                if (xs_is_ie) {
-                    var fl1 = start * 100;
-                    var fl2 = 100 - fl1;
-                    fr.style.filter = "progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=" + fl1 + ")";
-                    t.style.filter = "progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=" + fl2 + ")";
-                }
-                else {
-                    var fl1 = start;
-                    var fl2 = 1 - fl1;
-                    fr.style.opacity = fl1;
-                    t.style.opacity = fl2;
-                }
-                
-                setTimeout("pd_shareShowEffect1(\'"+from+"\', \'"+to+"\', "+(start - 0.1)+")", 10);
-            }
-            
-            function goToImage(n) {
-                var i = parseInt(currentShowPicture) + parseInt(n);
-                //alert(1);
-                
-                var start = curThumbsPage * (thumbsPerPage - 1);
-                var end = start + thumbsPerPage;
-                if (end > allFiles) end = allFiles;
-                
-                if (i >= end) {
-                    pd_changeThumbPage(1);
-                }
-                else if (i <= start) {
-                    pd_changeThumbPage(-1);
-                }
-                
-                if (i >= allFiles || i < 0) {
-                    if (isPlayStart) {
-                        onPlayClick();
-                    }
-                    return;
-                }
-                //pd_shareChangePicture(i, 1);
-                
-                pd_shareChangeImage(i);
-            }
-            
-            function froseControls(p) {
-                var incB = document.getElementById("incBut");
-                var decB = document.getElementById("decBut");
-                var firstBut = document.getElementById("firstBut");
-                var lastBut = document.getElementById("lastBut");
-                var playB = document.getElementById("playBut");
-                var selSizeSelect = document.getElementById("selSizeSelect");
-                
-                //isControlsFrosen = p;
-                
-                if (p) {
-                    incB.disabled = true;
-                    incB.src = prevButImgDisabled.src;
-                    incB.style.cursor = "default";
-                    incB.alt = "";
-                    
-                    decB.disabled = true;
-                    decB.src = nextButImgDisabled.src;
-                    decB.style.cursor = "default";
-                    decB.alt = "";
-                    
-                    firstBut.disabled = true;
-                    firstBut.src = firstButImgDisabled.src;
-                    firstBut.style.cursor = "default";
-                    firstBut.alt = "";
-                    
-                    lastBut.disabled = true;
-                    lastBut.src = lastButImgDisabled.src;
-                    lastBut.style.cursor = "default";
-                    lastBut.alt = "";
-                    
-                    if (!isPlayStart) {
-                        //playB.disabled = true;
-                    }
-                    
-                    selSizeSelect.disabled = true;
-                }
-                else {
-                    incB.disabled = false;
-                    incB.src = prevButImg.src;
-                    incB.style.cursor = "pointer";
-                    incB.alt = "'.$pdStrings['pd_slideshow_prev_label'].'";
-                    
-                    decB.disabled = false;
-                    decB.src = nextButImg.src;
-                    decB.style.cursor = "pointer";
-                    decB.alt = "'.$pdStrings['pd_slideshow_next_label'].'";
-                    
-                    firstBut.disabled = false;
-                    firstBut.src = firstButImg.src;
-                    firstBut.style.cursor = "pointer";
-                    firstBut.alt = "'.$pdStrings['pd_slideshow_first_label'].'";
-                    
-                    lastBut.disabled = false;
-                    lastBut.src = lastButImg.src;
-                    lastBut.style.cursor = "pointer";
-                    lastBut.alt = "'.$pdStrings['pd_slideshow_last_label'].'";
-                    
-                    if (!isPlayStart) {
-                        //playB.disabled = false;
-                    }
-                    
-                    selSizeSelect.disabled = false;
-                }
-                
-                if (currentShowPicture == 0) {
-                    incB.disabled = true;
-                    incB.src = prevButImgDisabled.src;
-                    incB.style.cursor = "default";
-                    incB.alt = "";
-                    
-                    firstBut.disabled = true;
-                    firstBut.src = firstButImgDisabled.src;
-                    firstBut.style.cursor = "default";
-                    firstBut.alt = "";
-                }
-                else if (currentShowPicture == (allFiles - 1)) {
-                    decB.disabled = true;
-                    decB.src = nextButImgDisabled.src;
-                    decB.style.cursor = "default";
-                    decB.alt = "";
-                    
-                    lastBut.disabled = true;
-                    lastBut.src = lastButImgDisabled.src;
-                    lastBut.style.cursor = "default";
-                    lastBut.alt = "";
-                }
-            }
-
-            function onPlayClick() {
-                var playB = document.getElementById("playBut");
-                if (!isPlayStart) {
-                    /*var delayEl = document.getElementsByName("playDelay");
-                    for (i = 0; i < delayEl.length; i ++) {
-                        if (delayEl[i].checked) {
-                            delay = delayEl[i].value;
-                            break;
-                        }
-                    }*/
-                    delay = 3;
-                    
-                    playB.src = pauseButImg.src;
-                    playB.alt = "'.$pdStrings['pd_slideshow_pause_label'].'";
-                    
-                    froseControls(true);
-                    
-                    if (delay != 0) {
-                        interval = setInterval("goToImage(1);", delay * 1000);
-                        isPlayStart = true;
-                    }
-                }
-                else {
-                    clearInterval(interval);
-                    playB.src = playButImg.src;
-                    playB.alt = "'.$pdStrings['pd_slideshow_play_label'].'";
-                    isPlayStart = false;
-                    delay = 0;
-                    froseControls(false);
-                }
-            }
-            
-            function showFilmPanel() {
-                var filmPanel = document.getElementById("filmPanel");
-                var filmSelector = document.getElementById("filmSelector");
-                
-                if (filmPanel.style.display == "none") {
-                    filmPanel.style.display = "block";
-                    filmSelector.innerHTML = "'.$pdStrings['pd_slideshow_hide_thumbs_label'].'";
-                }
-                else {
-                    filmPanel.style.display = "none";
-                    filmSelector.innerHTML = "'.$pdStrings['pd_slideshow_show_thumbs_label'].'";
-                }
-                
-                var st = new setThumbnailStatus();
-                st.tick();
-            }
-            
-            function setThumbnailStatus() {
-        		this.tick = function() {
-            		var req = new Subsys_JsHttpRequest_Js();
-            		var obj = this;
-            
-            		req.onreadystatechange = function() {
-            			if (req.readyState == 4) {
-            				if (req.responseJS) {
-            					if ( req.responseJS.state == "OK" ) {
-            					    //alert(req.responseJS.responseText);
-            					}
-            					if ( req.responseJS.error != "" ) {
-            						alert( req.responseJS.error );
-            					}
-            				}
-            			}
-            		}
-            		
-            		req.open("GET", "changeshowthumbstatus.php", true);
-            		req.send( { } );
-        		}
-        	}
-        </script>
-    ';
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/block.wbs_buttonSet.php
===================================================================
--- kernel/includes/smarty/plugins/block.wbs_buttonSet.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/block.wbs_buttonSet.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,30 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     block
- * Name:     wbs_buttonSet
- * Purpose:  Adds the button set markup
- * -------------------------------------------------------------
- */
-
-function smarty_block_wbs_buttonSet( $params, $content, &$smarty, &$repeat )
-{
-	$result = null;
-
-	if ( isset($content) )
-	{
-		$style = null;
-		if ( isset($params['width']) && strlen($params['width']) )
-			$style = sprintf( "style=\"width: %s\"", $params['width'] );
-
-		$result = "<ul class=\"ButtonSet\" $style>";
-		$result .= $content;
-		$result .= "</ul>";
-	}
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/block.wbs_formButtonsPanel.php
===================================================================
--- kernel/includes/smarty/plugins/block.wbs_formButtonsPanel.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/block.wbs_formButtonsPanel.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,30 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     block
- * Name:     wbs_formButtonsPanel
- * Purpose:  Adds the form buttons panel markup
- * -------------------------------------------------------------
- */
-
-function smarty_block_wbs_formButtonsPanel( $params, $content, &$smarty, &$repeat )
-{
-	$result = null;
-
-	if ( isset($content) )
-	{
-		extract( $params );
-
-		$result = "<tr class=\"FormButtons\">\n";
-		$result .= "	<td>\n";
-		$result .= $content;
-		$result .= "	</td>\n";
-		$result .= "</tr>\n";
-	}
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/block.wbs_formContent.php
===================================================================
--- kernel/includes/smarty/plugins/block.wbs_formContent.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/block.wbs_formContent.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,40 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     block
- * Name:     wbs_formContent
- * Purpose:  Adds the form content markup
- * -------------------------------------------------------------
- */
-
-function smarty_block_wbs_formContent( $params, $content, &$smarty, &$repeat )
-{
-	$result = null;
-
-	if ( isset($content) )
-	{
-		extract( $params );
-
-		$result = "<tr class=\"FormContent\">\n";
-		$result .= "	<td>\n";
-		$result .= "		<div>\n";
-
-		if ( !( isset($suppressTable) && $suppressTable ) )
-			$result .= "			<table class=\"FormLayout\">\n";
-
-		$result .= $content;
-
-		if ( !( isset($suppressTable) && $suppressTable ) )
-			$result .= "			</table>\n";
-
-		$result .= "		</div>\n";
-		$result .= "	</td>\n";
-		$result .= "</tr>\n";
-	}
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/block.wbs_note.php
===================================================================
--- kernel/includes/smarty/plugins/block.wbs_note.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/block.wbs_note.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,76 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     block
- * Name:     wbs_note
- * Purpose:  Outputs the note
- * -------------------------------------------------------------
- */
-
-function smarty_block_wbs_note( $params, $content, &$smarty, &$repeat )
-{
-	$result = null;
-
-	if ( isset($content) )
-	{
-		extract($params);
-
-		$useSmallFont = (isset($smallFont) && $smallFont) || !isset($smallFont);
-		$noteClass = $useSmallFont ? "SmallFontNote" : null;
-
-		$noteTextClass = null;
-		if ( isset($indented) && $indented )
-			$noteTextClass = "class=\"Indented\"";
-
-		$displayMarker = (isset($displayNoteMarker) && $displayNoteMarker) || !isset($displayNoteMarker);
-
-		if ( $smallFont  )
-
-		$style = array();
-		if ( isset($width) )
-			$style[] = "width: $width";
-
-		if ( isset($minWidth) )
-			$style[] = "min-width: $minWidth";
-
-		$style = count($style) ? "style=\"".implode(";", $style)."\"" : null;
-
-		$result = "<dl $style class=\"Note $noteClass\">\n";
-
-		if ( $displayMarker ) {
-			$kernelStrings = $smarty->get_template_vars('kernelStrings');
-
-			if ( !isset($noteType) || !strlen($noteType) )
-				$noteType = 'note';
-
-			$labelClass = null;
-			switch ( $noteType )
-			{
-				case 'note' :
-					$noteLabel = $kernelStrings['app_note_text'];
-
-					break;
-				case 'importantNote' :
-					$noteLabel = $kernelStrings['app_impnote_label'];
-					$labelClass = "class=\"ImportantNote\"";
-	
-					break;
-				case 'tips' :
-					$noteLabel = $kernelStrings['app_tips_label'];
-
-					break;
-			}
-
-			$result .= "	<dt $labelClass>".$noteLabel.":</dt>\n";
-		}
-
-		$result .= "	<dd $noteTextClass>$content</dd>\n";
-		$result .= "</dl>\n";
-	}
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.appName.php
===================================================================
--- kernel/includes/smarty/plugins/function.appName.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.appName.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,19 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     appName
- * Purpose:  returns WBS application name
- * -------------------------------------------------------------
- */
-
-function smarty_function_appName( $params, &$this )
-{
-    extract($params);
-
-	return getAppName( $APP_ID, $language );
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.assign_array.php
===================================================================
--- kernel/includes/smarty/plugins/function.assign_array.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.assign_array.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,39 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     assign_array
- * Purpose:  assign a value to a template array index
- * -------------------------------------------------------------
- */
-function smarty_function_assign_array($params, &$smarty)
-{
-    extract($params);
-
-    if (empty($var)) {
-        $smarty->trigger_error("assign: missing 'var' parameter");
-        return;
-    }
-
-    if (empty($index)) {
-        $smarty->trigger_error("assign: missing 'index' parameter");
-        return;
-    }
-
-    if (!in_array('value', array_keys($params))) {
-        $smarty->trigger_error("assign: missing 'value' parameter");
-        return;
-    }
-
-    $oldVal = $smarty->get_template_vars($var);
-
-    $oldVal[$index] = $value;
-
-    $smarty->assign($var, $oldVal);
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.busers_city.php
===================================================================
--- kernel/includes/smarty/plugins/function.busers_city.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.busers_city.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,31 +0,0 @@
-<?php
-
-/**
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     busers_city
- * Purpose:  return a city from customers addresess
- * -------------------------------------------------------------
- */
- 
-function smarty_function_busers_city($params, &$smarty)
-{
-	$idad = $smarty->get_template_vars('custforadid');
-	$query = "
-				SELECT city FROM SC_customer_addresses
-				WHERE customerID = $idad
-				";
-
-	$res = mysql_query($query) or die(mysql_error()."<br>$query");
-
-	$row = mysql_fetch_row($res);
-	
-	$color = 'blue';
-	$u_city = $row[0];
-	if ($u_city == "Днепропетровск" or $u_city == "днепропетровск" or $u_city == "ДНЕПРОПЕТРОВСК")
-		$color = 'red';
-		
-	echo "<span style='color:$color'>$u_city</span>";
-}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.conc_tree.php
===================================================================
--- kernel/includes/smarty/plugins/function.conc_tree.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.conc_tree.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,32 +0,0 @@
-<?php
-    function smarty_function_conc_tree ($params, &$smarty)
-    {
-        $auxpage = $params['auxpage'];
-        $disp  = '<ul id="navmenu-v"> ';
-        $disp .= '<li><a href="/">Мультитойс</a></li><li><a href="" aria-haspopup=true>Конкуренты</a><ul><li><a href="/auxpage_divoland" aria-haspopup=true>Диволенд</a></li><li><a href="/auxpage_mixtoys" aria-haspopup=true>Микстойс</a></li><li><a href="/auxpage_dreamtoys" aria-haspopup=true>Веселка</a></li><li><a href="/auxpage_alliance" aria-haspopup=true>Альянс</a></li></ul></li>';
-        $sql = 'SELECT DISTINCT parent FROM Conc__'.$auxpage.' ORDER BY parent';
-        if ($r = mysql_query($sql))
-            while ($res = mysql_fetch_assoc($r)) {
-                $disp .= '<li><a href="/auxpage_'.$auxpage.'?div_par='.$res['parent'].'" aria-haspopup=true>'.$res['parent'].'</a>';
-                $disp .= subcategory($res['parent'], $auxpage).'';
-            }
-        $disp .= '</ul>';
-        return $disp;
-    }
-
-    function subcategory ($parid, $auxpage)
-    {
-        $sql = "SELECT DISTINCT category FROM Conc__$auxpage WHERE parent='$parid'";
-        $disp = '';
-        if ($r = mysql_query($sql)) {
-            if (mysql_num_rows($r) > 0) {
-                $disp .= '<ul class="animated slideInRight">';
-                while ($res = mysql_fetch_assoc($r)) {
-                    $disp .= '<li>';
-                    $disp .= '<a href="/auxpage_'.$auxpage.'?div_cat='.$res['category'].'" aria-haspopup=true>'.$res['category'].'</a>';
-                }
-                $disp .= '</li></ul>';
-            }
-        }
-        return $disp;
-    }
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.conditionalLink.php
===================================================================
--- kernel/includes/smarty/plugins/function.conditionalLink.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.conditionalLink.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,34 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     conditionalLink
- * Purpose:  makes link paramter if href is not null
- * -------------------------------------------------------------
- */
-
-function smarty_function_conditionalLink( $params, &$this )
-{
-	extract($params);
-
-	if ( !is_null($confirm) )
-		$onClickTxt = sprintf( "onClick=\"return confirmLink('%s')\"", $confirm );
-	
-	if ( !empty($onClick) )
-		$onClickTxt = sprintf( "onClick=\"%s\"", $onClick);
-
-	if ( !isset( $class ) )
-		$class = null;
-
-	if ( !is_null($href) )
-		if ( !isset($spanClass) )
-			return sprintf( "<a href=\"%s\" class=\"%s\" %s title=\"%s\">%s</a>", $href, $class, $onClickTxt, $title, $text );
-		else
-			return sprintf( "<span class=\"%s\"><a href=\"%s\" class=\"%s\" %s title=\"%s\">%s</a></span>", $spanClass, $href, $class, $onClickTxt, $title, $text );
-	else
-		return $text;
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.count.php
===================================================================
--- kernel/includes/smarty/plugins/function.count.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.count.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,23 +0,0 @@
-<?php
-
-/**
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     count
- * Purpose:  assign a number of array members to 'item' param
- * -------------------------------------------------------------
- */
-function smarty_function_count($params, &$smarty)
-{
-	if(isset($params['assign'])){$params['item'] = $params['assign'];}
-	if(isset($params['var'])){$params['array'] = $params['var'];}
-	
-	if (!isset($params['item']))return 'Not set item param';
-	if (isset($params['array'])){
-		if (!is_array($params['array'])) $smarty->assign($params['item'], 0);
-		else 
-			$smarty->assign($params['item'], count($params['array']));
-	}else $smarty->assign($params['item'], 0);
-}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.cs_show_new_item.php
===================================================================
--- kernel/includes/smarty/plugins/function.cs_show_new_item.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.cs_show_new_item.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,45 +0,0 @@
-<?php
-
-/**
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     count
- * Purpose:  assign a number of array members to 'item' param
- * -------------------------------------------------------------
- */
-function smarty_function_cs_show_new_item($params, &$smarty)
-{
-  $count = 4;
-
-  $query = "
-SELECT * FROM SC_product_list_item
-LEFT JOIN SC_products ON SC_products.productID = SC_product_list_item.productID
-LEFT JOIN SC_product_pictures ON SC_product_pictures.productID = SC_products.productID
-WHERE list_id = 'newitems'
-ORDER BY RAND() LIMIT $count;";
-
-  $res   = mysql_query($query) or die(mysql_error()."<br>$query");
-  $products = '';
-  $i = 0;
-  while($row=mysql_fetch_object($res))
-  {
-    $i++;
-    $src = $row->thumbnail?URL_PRODUCTS_PICTURES.'/'.$row->thumbnail:'/img/nophoto.jpg';
-    $text = "<b>".strip_tags($row->name_ru)." $row->product_code"."</b>. ".strip_tags($row->brief_description_ru);
-
-    $line = ($i == $count)?"":"<hr width='90%' align='center' style='margin:10px 0 0 5%;'>";
-
-    $products .= "
-<div style='padding:0; margin:5px; width:137px; overflow-x:hidden;'>
-  <a href='index.php?productID=$row->productID' style='text-decoration:none;'>
-    <div style='text-align:center'><img src='$src' style='width:135px;'></div>
-    $text
-  </a>
-  $line
-</div>";
-  }
-
-  return $products;
-}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.get_topproducts.php
===================================================================
--- kernel/includes/smarty/plugins/function.get_topproducts.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.get_topproducts.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,45 +0,0 @@
-<?php
-
-function smarty_function_get_topproducts( $params, &$smarty )
-{
-	extract($params);
-    if( !empty($params['var']) )
-    {
-        $where = '';
-        $limit = isset($params['limit']) ? 'LIMIT '.(int)$params['limit'] : '';
-        $top = $params['var'];
-        // $cust = $params['cust_data'];
-        // $skidka1 = $cust['cust_skidka'];
-        // $special = $cust['cust_price'];
-        // $margin = $cust['cust_margin'];
-
-        if( CONF_CHECKSTOCK ) {
-            $where .= " AND ";
-            $where .= "in_stock > 0";
-        }
-
-        $sql = "
-            SELECT productID, ".LanguagesManager::sql_prepareField("name")." AS name,
-            Price, SpecialPrice, list_price, items_sold, sort_order, akcia, akcia_skidka, skidka, default_picture, slug FROM ".PRODUCTS_TABLE."
-            WHERE enabled != 0 AND categoryID > 1 AND $top > 0 AND zakaz <> 1 ".$where."
-            ORDER BY  RAND() ".$limit."
-        ";
-        $q = db_query($sql);
-        $products=array();
-        while( $row = db_fetch_assoc($q) )
-        {
-            // $row["productID_str"] = $row["productID"];
-			$price = ZCalcPrice($row["Price"], $row["SpecialPrice"], $row["skidka"]);
-            $row["price_str"] = show_price($price);
-			$row["list_price_str"] = show_price($row["list_price"]);
-			// $row["akcia_skidka_str"] = $row["akcia_skidka"];
-            $products[] = $row;
-        }
-
-        _setPictures($products);
-
-        $smarty->assign('top', $top);
-        $smarty->assign($params["var"], $products);
-    }
-}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.get_topview.php
===================================================================
--- kernel/includes/smarty/plugins/function.get_topview.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.get_topview.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,41 +0,0 @@
-<?php
-
-function smarty_function_get_topview( $params, &$smarty )
-{
-    if( !empty($params["var"]) )
-    {
-        $where = "";
-        $limit = isset($params["limit"]) ? "LIMIT ".(int)$params["limit"] : "";
-
-        if( CONF_CHECKSTOCK ) {
-            $where .= " AND ";
-            $where .= "in_stock > 0";
-        }
-
-        // $sql = "
-            // SELECT productID, ".LanguagesManager::sql_prepareField("name")." AS name,
-            // Price, default_picture, slug FROM ".PRODUCTS_TABLE."
-            // WHERE enabled != 0 AND categoryID > 1 ".$where."
-            // ORDER BY viewed_times DESC ".$limit."
-        // ";        
-		  $sql = "
-            SELECT * FROM SC_product_list_item
-LEFT JOIN SC_products ON SC_products.productID = SC_product_list_item.productID
-LEFT JOIN SC_product_pictures ON SC_product_pictures.productID = SC_products.productID
-WHERE list_id = 'hitu'
-ORDER BY RAND() $limit";
-        
-        $q = db_query($sql);
-        $products=array();
-        while( $row = db_fetch_row($q) )
-        {
-            $row["price_str"] = show_price($row["Price"]);
-            $products[] = $row;
-        }
-
-        _setPictures($products);
-
-        $smarty->assign($params["var"], $products);
-    }
-}
-
Index: kernel/includes/smarty/plugins/function.html_select_date.php
===================================================================
--- kernel/includes/smarty/plugins/function.html_select_date.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.html_select_date.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,322 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-/**
- * Smarty {html_select_date} plugin
- *
- * Type:     function<br>
- * Name:     html_select_date<br>
- * Purpose:  Prints the dropdowns for date selection.
- *
- * ChangeLog:<br>
- *           - 1.0 initial release
- *           - 1.1 added support for +/- N syntax for begin
- *                and end year values. (Monte)
- *           - 1.2 added support for yyyy-mm-dd syntax for
- *                time value. (Jan Rosier)
- *           - 1.3 added support for choosing format for
- *                month values (Gary Loescher)
- *           - 1.3.1 added support for choosing format for
- *                day values (Marcus Bointon)
- *           - 1.3.2 suppport negative timestamps, force year
- *             dropdown to include given date unless explicitly set (Monte)
- * @link http://smarty.php.net/manual/en/language.function.html.select.date.php {html_select_date}
- *      (Smarty online manual)
- * @version 1.3.2
- * @author   Andrei Zmievski
- * @param array
- * @param Smarty
- * @return string
- */
-function smarty_function_html_select_date($params, &$smarty)
-{
-    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
-    require_once $smarty->_get_plugin_filepath('shared','make_timestamp');
-    require_once $smarty->_get_plugin_filepath('function','html_options');
-    /* Default values. */
-    $prefix          = "Date_";
-    $start_year      = strftime("%Y");
-    $end_year        = $start_year;
-    $display_days    = true;
-    $display_months  = true;
-    $display_years   = true;
-    $month_format    = "%B";
-    /* Write months as numbers by default  GL */
-    $month_value_format = "%m";
-    $day_format      = "%02d";
-    /* Write day values using this format MB */
-    $day_value_format = "%d";
-    $year_as_text    = false;
-    /* Display years in reverse order? Ie. 2000,1999,.... */
-    $reverse_years   = false;
-    /* Should the select boxes be part of an array when returned from PHP?
-       e.g. setting it to "birthday", would create "birthday[Day]",
-       "birthday[Month]" & "birthday[Year]". Can be combined with prefix */
-    $field_array     = null;
-    /* <select size>'s of the different <select> tags.
-       If not set, uses default dropdown. */
-    $day_size        = null;
-    $month_size      = null;
-    $year_size       = null;
-    /* Unparsed attributes common to *ALL* the <select>/<input> tags.
-       An example might be in the template: all_extra ='class ="foo"'. */
-    $all_extra       = null;
-    /* Separate attributes for the tags. */
-    $day_extra       = null;
-    $month_extra     = null;
-    $year_extra      = null;
-    /* Order in which to display the fields.
-       "D" -> day, "M" -> month, "Y" -> year. */
-    $field_order     = 'MDY';
-    /* String printed between the different fields. */
-    $field_separator = "\n";
-    $time = time();
-    $all_empty       = null;
-    $day_empty       = null;
-    $month_empty     = null;
-    $year_empty      = null;
-    $extra_attrs     = '';
-
-    foreach ($params as $_key=>$_value) {
-        switch ($_key) {
-            case 'prefix':
-            case 'time':
-            case 'start_year':
-            case 'end_year':
-            case 'month_format':
-            case 'day_format':
-            case 'day_value_format':
-            case 'field_array':
-            case 'day_size':
-            case 'month_size':
-            case 'year_size':
-            case 'all_extra':
-            case 'day_extra':
-            case 'month_extra':
-            case 'year_extra':
-            case 'field_order':
-            case 'field_separator':
-            case 'month_value_format':
-            case 'month_empty':
-            case 'day_empty':
-            case 'year_empty':
-                $$_key = (string)$_value;
-                break;
-
-            case 'all_empty':
-                $$_key = (string)$_value;
-                $day_empty = $month_empty = $year_empty = $all_empty;
-                break;
-
-            case 'display_days':
-            case 'display_months':
-            case 'display_years':
-            case 'year_as_text':
-            case 'reverse_years':
-                $$_key = (bool)$_value;
-                break;
-
-            default:
-                if(!is_array($_value)) {
-                    $extra_attrs .= ' '.$_key.'="'.smarty_function_escape_special_chars($_value).'"';
-                } else {
-                    $smarty->trigger_error("html_select_date: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
-                }
-                break;
-        }
-    }
-
-    if(preg_match('!^-\d+$!',$time)) {
-        // negative timestamp, use date()
-        $time = date('Y-m-d',$time);
-    }
-    // If $time is not in format yyyy-mm-dd
-    if (!preg_match('/^\d{0,4}-\d{0,2}-\d{0,2}$/', $time)) {
-        // use smarty_make_timestamp to get an unix timestamp and
-        // strftime to make yyyy-mm-dd
-        $time = strftime('%Y-%m-%d', smarty_make_timestamp($time));
-    }
-    // Now split this in pieces, which later can be used to set the select
-    $time = explode("-", $time);
-    
-    // make syntax "+N" or "-N" work with start_year and end_year
-    if (preg_match('!^(\+|\-)\s*(\d+)$!', $end_year, $match)) {
-        if ($match[1] == '+') {
-            $end_year = strftime('%Y') + $match[2];
-        } else {
-            $end_year = strftime('%Y') - $match[2];
-        }
-    }
-    if (preg_match('!^(\+|\-)\s*(\d+)$!', $start_year, $match)) {
-        if ($match[1] == '+') {
-            $start_year = strftime('%Y') + $match[2];
-        } else {
-            $start_year = strftime('%Y') - $match[2];
-        }
-    }
-    if (strlen($time[0]) > 0) { 
-        if ($start_year > $time[0] && !isset($params['start_year'])) {
-            // force start year to include given date if not explicitly set
-            $start_year = $time[0];
-        }
-        if($end_year < $time[0] && !isset($params['end_year'])) {
-            // force end year to include given date if not explicitly set
-            $end_year = $time[0];
-        }
-    }
-
-    $field_order = strtoupper($field_order);
-
-    $html_result = $month_result = $day_result = $year_result = "";
-
-    if ($display_months) {
-        $month_names = array();
-        $month_values = array();
-        if(isset($month_empty)) {
-            $month_names[''] = $month_empty;
-            $month_values[''] = '';
-        }
-        for ($i = 1; $i <= 12; $i++) {
-            $month_names[$i] = strftime($month_format, mktime(0, 0, 0, $i, 1, 2000));
-            $month_values[$i] = strftime($month_value_format, mktime(0, 0, 0, $i, 1, 2000));
-        }
-
-        $month_result .= '<select name=';
-        if (null !== $field_array){
-            $month_result .= '"' . $field_array . '[' . $prefix . 'Month]"';
-        } else {
-            $month_result .= '"' . $prefix . 'Month"';
-        }
-        if (null !== $month_size){
-            $month_result .= ' size="' . $month_size . '"';
-        }
-        if (null !== $month_extra){
-            $month_result .= ' ' . $month_extra;
-        }
-        if (null !== $all_extra){
-            $month_result .= ' ' . $all_extra;
-        }
-        $month_result .= $extra_attrs . '>'."\n";
-
-        $month_result .= smarty_function_html_options(array('output'     => $month_names,
-                                                            'values'     => $month_values,
-                                                            'selected'   => (int)$time[1] ? strftime($month_value_format, mktime(0, 0, 0, (int)$time[1], 1, 2000)) : '',
-                                                            'print_result' => false),
-                                                      $smarty);
-        $month_result .= '</select>';
-    }
-
-    if ($display_days) {
-        $days = array();
-        if (isset($day_empty)) {
-            $days[''] = $day_empty;
-            $day_values[''] = '';
-        }
-        for ($i = 1; $i <= 31; $i++) {
-            $days[] = sprintf($day_format, $i);
-            $day_values[] = sprintf($day_value_format, $i);
-        }
-
-        $day_result .= '<select name=';
-        if (null !== $field_array){
-            $day_result .= '"' . $field_array . '[' . $prefix . 'Day]"';
-        } else {
-            $day_result .= '"' . $prefix . 'Day"';
-        }
-        if (null !== $day_size){
-            $day_result .= ' size="' . $day_size . '"';
-        }
-        if (null !== $all_extra){
-            $day_result .= ' ' . $all_extra;
-        }
-        if (null !== $day_extra){
-            $day_result .= ' ' . $day_extra;
-        }
-        $day_result .= $extra_attrs . '>'."\n";
-        $day_result .= smarty_function_html_options(array('output'     => $days,
-                                                          'values'     => $day_values,
-                                                          'selected'   => $time[2],
-                                                          'print_result' => false),
-                                                    $smarty);
-        $day_result .= '</select>';
-    }
-
-    if ($display_years) {
-        if (null !== $field_array){
-            $year_name = $field_array . '[' . $prefix . 'Year]';
-        } else {
-            $year_name = $prefix . 'Year';
-        }
-        if ($year_as_text) {
-            $year_result .= '<input type="text" name="' . $year_name . '" value="' . $time[0] . '" size="4" maxlength="4"';
-            if (null !== $all_extra){
-                $year_result .= ' ' . $all_extra;
-            }
-            if (null !== $year_extra){
-                $year_result .= ' ' . $year_extra;
-            }
-            $year_result .= ' />';
-        } else {
-            $years = range((int)$start_year, (int)$end_year);
-            if ($reverse_years) {
-                rsort($years, SORT_NUMERIC);
-            } else {
-                sort($years, SORT_NUMERIC);
-            }
-            $yearvals = $years;
-            if(isset($year_empty)) {
-                array_unshift($years, $year_empty);
-                array_unshift($yearvals, '');
-            }
-            $year_result .= '<select name="' . $year_name . '"';
-            if (null !== $year_size){
-                $year_result .= ' size="' . $year_size . '"';
-            }
-            if (null !== $all_extra){
-                $year_result .= ' ' . $all_extra;
-            }
-            if (null !== $year_extra){
-                $year_result .= ' ' . $year_extra;
-            }
-            $year_result .= $extra_attrs . '>'."\n";
-            $year_result .= smarty_function_html_options(array('output' => $years,
-                                                               'values' => $yearvals,
-                                                               'selected'   => $time[0],
-                                                               'print_result' => false),
-                                                         $smarty);
-            $year_result .= '</select>';
-        }
-    }
-
-    // Loop thru the field_order field
-    for ($i = 0; $i <= 2; $i++){
-        $c = substr($field_order, $i, 1);
-        switch ($c){
-            case 'D':
-                $html_result .= $day_result;
-                break;
-
-            case 'M':
-                $html_result .= $month_result;
-                break;
-
-            case 'Y':
-                $html_result .= $year_result;
-                break;
-        }
-        // Add the field seperator
-        if($i != 2) {
-            $html_result .= $field_separator;
-        }
-    }
-
-    return $html_result;
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.html_text.php
===================================================================
--- kernel/includes/smarty/plugins/function.html_text.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.html_text.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,61 +0,0 @@
-<?php
-	/**
-	 * Enter description here...
-	 *
-	 * @param array $params: ('name' => string, 'values'=>array, 'table'=>string)
-	 * @param Smarty $smarty
-	 * @return string
-	 */
-	function smarty_function_html_text($params, &$smarty){
-		
-		extract($params);
-		$uid = rand_name(2);
-		$langManager = &LanguagesManager::getInstance();
-		$languages = $langManager->languages;
-		$html_langs_hidden = '';
-		$html_langs = '';
-		$dbfield = isset($dbfield)?$dbfield:$name;
-
-		$lang_num = count($languages);
-		foreach ($languages as $languageEntry){
-			/*@var $languageEntry Language*/
-			$lang_iso2 = $languageEntry->iso2;
-			$input_name = $name.'_'.$lang_iso2;
-			if(strpos($name,'%lang%') !== false){
-				$input_name = str_replace('%lang%', $lang_iso2, $name);
-			}
-			
-			$lang_html = "\n".'
-			<tr>
-				'.($lang_num>1?'
-				<td style="vertical-align:top; padding-top:5px!important;" '.(isset($style)&&preg_match('@width:\s?100\%@', $style)?' width="1%"':'').'>'.($languageEntry->getThumbnailURL()?'<img hspace="4" src="'.xHtmlSpecialChars($languageEntry->getThumbnailURL()).'" alt="'.xHtmlSpecialChars($languageEntry->getName()).'" />':xHtmlSpecialChars($languageEntry->getName())).'</td>
-				':'').'
-				<td>
-					<input type="text" lang="'.$lang_iso2.'"'.(isset($id)?" id='{$id}_{$lang_iso2}'":'').' name="'.xHtmlSpecialChars($input_name).'" value="'.xHtmlSpecialChars($values[$dbfield.'_'.$lang_iso2]).'" '.(isset($size)?"size='{$size}'":'').' '.(isset($style)?"style='{$style}'":'').(isset($class)?" class='{$class}'":'').' />
-				</td>
-			</tr>';
-			if($values[$dbfield.'_'.$lang_iso2] || $languageEntry->isDefault()){
-				
-				$html_langs .= $lang_html;
-			}else{
-				
-				$html_langs_hidden .= $lang_html;
-			}
-		}
-
-		return '
-		<table'.(isset($style)?' style="'.$style.'"':'').' cellpadding="0" cellspacing="0" class="lang_fields">
-		<tr>
-			<td><table'.(isset($style)?' style="'.$style.'"':'').' cellpadding="0" cellspacing="0">'.$html_langs.'</table>
-			'.($lang_num>1&&$html_langs_hidden?'
-				
-				<div id="'.xHtmlSpecialChars($input_name.'s_hd-'.$uid).'" style="display:none;">
-				<table'.(isset($style)?' style="'.$style.'"':'').' cellpadding="0" cellspacing="0">'.$html_langs_hidden.'</table>
-				</div></td>
-				
-			<td width="11" valign="bottom" '.(isset($style)&&preg_match('@width:\s?100\%@', $style)?' width="1%"':'').'><a title="'.xHtmlSpecialChars(translate('loc_show_empty_translations')).'" href="#expand" class="expand_languages" rel="'.xHtmlSpecialChars($input_name.'s_hd-'.$uid).'"><img hspace="4" src="images_common/show_other_languages.gif" alt="'.xHtmlSpecialChars(translate('loc_show_empty_translations')).'" width="11" height="11" /></a>':'').'</td>
-		</tr>
-		</table>
-		';
-	}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.html_xhina.php
===================================================================
--- kernel/includes/smarty/plugins/function.html_xhina.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.html_xhina.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,48 +0,0 @@
-<?php
-function smarty_function_html_xhina($params, &$smarty)
-{
-	
-	return @"
-<textarea id='".$params['name']."' name='".$params['name']."' rows='".$params['rows']."' cols='50' style='".$params['style']."'>".$params['value']."</textarea>
-  <script type='text/javascript'>
-    _editor_url  = 'modules/xhina/'  // (preferably absolute) URL (including trailing slash) where Xinha is installed
-    _editor_lang = 'en';      // And the language we need to use in the editor.
-  </script>
-  <script type='text/javascript' src='modules/xhina/htmlarea.js'></script>
-  <script type='text/javascript'>
-    xinha_editors = null;
-    xinha_init    = null;
-    xinha_config  = null;
-    xinha_plugins = null;
-
-    // This contains the names of textareas we will make into Xinha editors
-    xinha_init = xinha_init ? xinha_init : function()
-    {
-
-      xinha_plugins = xinha_plugins ? xinha_plugins :
-      [
-       'ContextMenu',
-       'FullScreen',
-       'ListType',
-       'TableOperations',
-       'ImageManager'
-      ];
-             if(!HTMLArea.loadPlugins(xinha_plugins, xinha_init)) return;
-
-      xinha_editors = xinha_editors ? xinha_editors :
-      [
-        '".$params['name']."'
-      ];
-
-       xinha_config = xinha_config ? xinha_config() : new HTMLArea.Config();
-
-       xinha_editors   = HTMLArea.makeEditors(xinha_editors, xinha_config, xinha_plugins);
-
-      HTMLArea.startEditors(xinha_editors);
-    }
-
-    xinha_init();
-    </script>
-     ";
-}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.in_array.php
===================================================================
--- kernel/includes/smarty/plugins/function.in_array.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.in_array.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,22 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     in_array
- * Purpose:  Checks if a value exists in an array 
- * -------------------------------------------------------------
- */
-function smarty_function_in_array($params, &$smarty)
-{
-    extract($params);
-
-	$result = in_array( $value, $arr );
-
-    $smarty->assign($assign, $result);
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.inarray.php
===================================================================
--- kernel/includes/smarty/plugins/function.inarray.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.inarray.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,23 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     inarray
- * Purpose:  PHP in_array() function implementation
- * -------------------------------------------------------------
- */
-
-function smarty_function_inarray( $params, &$smarty )
-{
-    extract($params);
-
-	$result = in_array($val, $array);
-
-	if ( !empty($var) ) {
-	    $smarty->assign($var, $result);
-    }
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.mime_decode.php
===================================================================
--- kernel/includes/smarty/plugins/function.mime_decode.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.mime_decode.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,20 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     mime_decode
- * Purpose:  decodes and outputs string using base64 functions
- * -------------------------------------------------------------
- */
-
-function smarty_function_mime_decode( $params, &$this )
-{
-    extract($params);
-
-	echo base64_decode($string);
-}
-
-
-?>
Index: kernel/includes/smarty/plugins/function.mnName.php
===================================================================
--- kernel/includes/smarty/plugins/function.mnName.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.mnName.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,19 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     scrName
- * Purpose:  returns WBS mail notification name
- * -------------------------------------------------------------
- */
-
-function smarty_function_mnName( $params, &$this )
-{
-    extract($params);
-
-	return getNotificationName( $APP_ID, $mnID, $language );
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.newtree02112014.php
===================================================================
--- kernel/includes/smarty/plugins/function.newtree02112014.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.newtree02112014.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,42 +0,0 @@
-<?php 
-  function smarty_function_newtree($params, &$smarty){ 
-$disp.='<ul id="navmenu-v"> '; 
-  $sql='SELECT categoryID, slug, parent, '.LanguagesManager::sql_prepareField('name').' AS name from '.CATEGORIES_TABLE. ' where parent=1 order by sort_order,name'; 
-  if($r=mysql_query($sql)) 
-  while($res=mysql_fetch_assoc($r)){ 
-  $disp.='<li >'; 
-   
-  if($res['slug']!='') 
-   
-  $disp.='<a href="index.php?categoryID='.$res['categoryID'].'/" aria-haspopup="true">'.$res['name'].'</a>'; 
-  else 
-  $disp.='<a href="?categoryID='.$res['categoryID'].'" aria-haspopup="true">'.$res['name'].'</a>'; 
-  $disp.=subcat($res['categoryID']).''; 
-  } 
-  $disp.='</li><li>
-						<a href="index.php?ukey=auxpage_new_items">Последние поступления</a>
-              </li></ul>'; 
-  return $disp; 
-  } 
-
-  function subcat($parid){ 
-  $sql='SELECT categoryID, slug, parent, '.LanguagesManager::sql_prepareField('name').' AS name from '.CATEGORIES_TABLE. ' where parent='.$parid.' order by sort_order, name'; 
-  if($r=mysql_query($sql)){ 
-  if(mysql_num_rows($r)>0){ 
-  $disp.='<ul >'; 
-  while($res=mysql_fetch_assoc($r)){ 
-  $disp.='<li >'; 
-  if($_GET['categoryID'] == $res['categoryID']) ; 
-  if($res['slug']!='') 
-  $disp.='<a href="index.php?categoryID='.$res['categoryID'].'/">'.$res['name'].'</a>'; 
-  else 
-  $disp.='<a href="?categoryID='.$res['categoryID'].'">'.$res['name'].'</a>'; 
-  $disp.=subcat($res['categoryID']).''; 
-  } 
-  $disp.='</li></ul>'; 
-  } 
-  } 
-  return $disp; 
-  } 
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.print_r.php
===================================================================
--- kernel/includes/smarty/plugins/function.print_r.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.print_r.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,18 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     print_r
- * Purpose:  print out a variable
- * -------------------------------------------------------------
- */
-function smarty_function_print_r($params, &$smarty)
-{
-	extract($params);
-
-	print_r( $var );
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.scrName.php
===================================================================
--- kernel/includes/smarty/plugins/function.scrName.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.scrName.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,19 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     scrName
- * Purpose:  returns WBS screen name
- * -------------------------------------------------------------
- */
-
-function smarty_function_scrName( $params, &$this )
-{
-    extract($params);
-
-	return getScreenName( $APP_ID, $SCR_ID, $language );
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.separate.php
===================================================================
--- kernel/includes/smarty/plugins/function.separate.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.separate.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,19 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     separate
- * Purpose:  outputs array of strings separated with commas
- * -------------------------------------------------------------
- */
-
-function smarty_function_separate( $params, &$smarty )
-{
-    extract($params);
-
-	return implode( ", ", $params );
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.smartanchor.php
===================================================================
--- kernel/includes/smarty/plugins/function.smartanchor.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.smartanchor.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,19 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     smart anchor
- * Purpose:  returns <a> tag if $href parameter is not empty
- * -------------------------------------------------------------
- */
-
-function smarty_function_smartanchor( $params, &$this )
-{
-    extract($params);
-
-	return ( strlen( $href ) ) ? sprintf( "<a href=%s>", $href ) : null;
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.strlen.php
===================================================================
--- kernel/includes/smarty/plugins/function.strlen.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.strlen.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,20 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     strlen
- * Purpose:  returns string length
- * -------------------------------------------------------------
- */
-
-function smarty_function_strlen( $params, &$this )
-{
-    extract($params);
-
-	return strlen($string);
-}
-
-
-?>
Index: kernel/includes/smarty/plugins/function.wbs_formCaption.php
===================================================================
--- kernel/includes/smarty/plugins/function.wbs_formCaption.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.wbs_formCaption.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,21 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     wbs_formCaption
- * Purpose:  Outputs the form caption
- * -------------------------------------------------------------
- */
-
-function smarty_function_wbs_formCaption( $params, &$smarty )
-{
-	extract( $params );
-
-	$result = "<span class=\"FormCaption\">".$params['text']."</span>";
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.wbs_initLayout.php
===================================================================
--- kernel/includes/smarty/plugins/function.wbs_initLayout.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.wbs_initLayout.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,135 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     wbs_initlayout
- * Purpose:  Initializes the page layout
- * -------------------------------------------------------------
- */
-
-function smarty_function_wbs_initLayout( $params, &$smarty )
-{
-	extract( $params );
-
-	$lang = $smarty->get_template_vars ('language');
-	$corners = $smarty->get_template_vars ('corners');
-	$title = $smarty->get_template_vars( 'pageTitle' );
-	$result = "<title>$title</title>";
-	$disableExt = !empty($params["disableExt"]);
-	$needExt = ($smarty->get_template_vars("needExt") || isset($needExt));
-	
-	$charset = $smarty->get_template_vars( 'html_encoding' );
-
-	$colorTheme = $smarty->get_template_vars( 'theme' );
-	//$layout = $smarty->get_template_vars( 'layout' );
-	$layout = "topmenu";
-	
-	/*if (defined("LOOKANDFEEL_PREVIEW")) {
-		global $_GET;
-		if (!empty($_GET["theme"]))
-			$colorTheme = $_GET["theme"];
-		if (!empty($_GET["corners"])) {
-			$corners = $_GET["corners"];
-			$smarty->assign ("corners", $corners);
-		}
-	}*/
-
-	$result .= "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=$charset\"/>\n";
-	if (!$disableExt) {
-		$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/old/all.js\"></script>\n";
-		if ($lang != LANG_ENG) 
-			$result .= "<script type=\"text/javascript\" src='../../../common/html/res/ext/build/locale/ext-lang-" . substr($lang, 0,2) . ".js'></script>";
-		
-	}	
-	
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/old/all.css\" type=\"text/css\"/>\n";
-
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/layout/$layout/layout.css\" type=\"text/css\"/>\n";
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/base_ie7.css\" type=\"text/css\"/><![endif]-->\n";	
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" type=\"text/css\" href=\"../../../common/html/cssbased/layout/$layout/layout_ie7.css\" /><![endif]-->\n";
-	
-	
-	
-	// Set the layout paramters
-	//
-	$layoutParams = array();
-	//if ( isset($toolbar) && $toolbar )
-		$layoutParams[] = 'toolbar=1';
-
-	if ( !empty($splitter))
-		$layoutParams[] = 'splitter=1';
-	
-	if ( isset($htmlArea) && $htmlArea ) {
-
-		$tplParams = array();
-		$tplParams['smarty_include_tpl_file'] = "../../../common/html/classic/htmlareasetup.tpl";
-		$tplParams['smarty_include_vars'] = $smarty->get_template_vars();
-
-		ob_start();
-		$smarty->_smarty_include($tplParams);
-		$result .= ob_get_clean();
-	}
-
-	$directAccess = (isset($_SESSION['HIDENAVIGATION']) && ($_SESSION['HIDENAVIGATION'] == 1)) || (isset($directAccess) && $directAccess);
-	$fullScreen = (!empty($_COOKIE["screenMode"]) && $_COOKIE["screenMode"] == "min");
-	$inplaceScreen = $smarty->get_template_vars ('inplaceScreen');
-
-	if ( $directAccess  )
-		$layoutParams[] = 'da=1';
-	
-	if ($fullScreen && !$disableExt)
-		$layoutParams[] = 'fullscreen=1';
-	
-	//if ($inplaceScreen)
-		$layoutParams[] = 'inplace=1';
-
-	if ( isset($noScroll) && $noScroll )
-		$layoutParams[] = 'ns=1';
-
-	$layoutParams = implode( "&amp;", $layoutParams );
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/layout/$layout/setlayout.php?$layoutParams\" type=\"text/css\"/>\n";
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/layout/$layout/setlayout_ie7.php?$layoutParams\" type=\"text/css\"/><![endif]-->\n";
-	if (!$disableExt)
-		$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/layout/$layout/layout.js\"></script>\n";
-	
-	$result .= "\n<script type='text/javascript'>\n";
-	$result .= "var directAccess=" . ($directAccess ? 1 : 0) . ";\n";
-	$result .= "var inplaceScreen=" . ($inplaceScreen ? 1 : 0) . ";\n";
-	$result .= "</script>\n";
-	
-	if (!$disableExt) {
-		if (!defined("LOOKANDFEEL_PREVIEW")) 
-			$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/init.js\"></script>\n";
-		else
-			$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/init_light.js\"></script>\n";
-	}
-
-	$htmlAreaIE6CSS =  isset($htmlAreaIE6CSS) ?  $htmlAreaIE6CSS : true;
-
-	if ( isset($htmlArea) && $htmlArea && $htmlAreaIE6CSS )
-		$result .= "<!--[if IE 6]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/htmlarea_ie6.css\" type=\"text/css\"/><![endif]-->\n";
-
-	// Attach the color scheme stylesheet
-	//
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/themes/common.css\" type=\"text/css\"/>\n";
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/colors_common.css\" type=\"text/css\"/>\n";
-	//$result .= "<!--[if IE 7]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/colors_ie7.css\" type=\"text/css\"/><![endif]-->\n";
-	
-	
-	
-	// Add Ext-module css
-	
-	if (!$disableExt && $needExt) {
-		$result .= "<link rel='stylesheet' type='text/css' href='../../../common/html/res/ext/resources/css/ext.css'>";
-		$result .= "<script>Ext.BLANK_IMAGE_URL = '../../../common/html/res/ext/resources/images/default/s.gif'</script>";
-	}
-	
-	if (!empty($splitter)) 
-		$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/splitter.js\"></script>\n";
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.wbs_initLayout1.php
===================================================================
--- kernel/includes/smarty/plugins/function.wbs_initLayout1.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.wbs_initLayout1.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,163 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     wbs_initlayout
- * Purpose:  Initializes the page layout
- * -------------------------------------------------------------
- */
-
-function smarty_function_wbs_initLayout( $params, &$smarty )
-{
-	extract( $params );
-
-	$lang = $smarty->get_template_vars ('language');
-	$corners = $smarty->get_template_vars ('corners');
-	$title = $smarty->get_template_vars( 'pageTitle' );
-	$result = "<title>$title</title>";
-	$needExt = ($smarty->get_template_vars("needExt") || isset($needExt));
-
-	$charset = $smarty->get_template_vars( 'html_encoding' );
-
-	$colorTheme = $smarty->get_template_vars( 'theme' );
-	$layout = $smarty->get_template_vars( 'layout' );
-	
-	if (defined("LOOKANDFEEL_PREVIEW")) {
-		global $_GET;
-		if (!empty($_GET["theme"]))
-			$colorTheme = $_GET["theme"];
-		if (!empty($_GET["corners"])) {
-			$corners = $_GET["corners"];
-			$smarty->assign ("corners", $corners);
-		}
-	}
-
-	$result .= "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=$charset\"/>\n";
-	
-	$result .= "<script src='../../../common/html/res/ext/pr-prototype.js'></script>";
-	//if ($needExt) {
-		// Add the ExtJs module
-		//$result .= "<script src='../../../common/html/res/ext/ext-base.js'></script>";
-		$result .= "<script src='../../../common/html/res/ext/pr-adapter.js'></script>";
-		$result .= "<script src='../../../common/html/res/ext/pr-effects.js'></script>";
-		//$result .= "<script src='../../../common/html/res/ext/pr-scriptaculous.js'></script>";
-		
-		$result .= "<script src='../../../common/html/res/ext/ext-all.js'></script>"; 
-		if ($lang != LANG_ENG) 
-			$result .= "<script src='../../../common/html/res/ext/build/locale/ext-lang-" . substr($lang, 0,2) . ".js'></script>";
-	//}
-	
-	//$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/prototype.js\"></script>\n";
-	$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/domready.js\"></script>\n";
-	$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/common.js\"></script>\n";
-	$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/layout.js\"></script>\n";
-	$result .= "<script type=\"text/javascript\" src=\"../../../common/html/res/wbscommon.js\"></script>\n";
-	$result .= "<script type=\"text/javascript\" src=\"../../../common/help/helpopen.js\"></script>\n";
-	
-	
-	// NiftyCube JS include and Start
-	if ($corners == "rounded") {
-		$result .= "<script type='text/javascript' src='../../../common/html/cssbased/geometry/rounded/niftycube.js'></script>\n";
-		//$result .= "<script>RegisterOnLoad (function(){Nifty('a.Button,div.MenuBlock','small transparent');});</script>";
-		//$result .= "<script>RegisterOnLoad (function(){Nifty('dd.Tab','small transparent top');});</script>";
-		
-		$result .= "<script type='text/javascript' src='../../../common/html/cssbased/geometry/rounded/rcorners.js'></script>\n";
-		$result .= "<script>RegisterOnLoad (function() {startRCorners();});</script>\n";
-		$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/geometry/rounded/geometry.css\" type=\"text/css\"/>\n";
-	} else {
-		$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/geometry/straight/geometry.css\" type=\"text/css\"/>\n";
-	}
-
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/base.css\" type=\"text/css\"/>\n";
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/base_ie7.css\" type=\"text/css\"/><![endif]-->\n";
-
-	// Attach the theme layout stylesheet
-	//
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/toolbar.css\" type=\"text/css\"/>\n";
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/layout/$layout/layout.css\" type=\"text/css\"/>\n";	
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" type=\"text/css\" href=\"../../../common/html/cssbased/layout/$layout/layout_ie7.css\" /><![endif]-->\n";
-	$result .= "<link rel='stylesheet' type='text/css' href='../../../common/html/cssbased/geometry/rounded/niftyCorners.css'>\n";
-
-	// Set the layout paramters
-	//
-	$layoutParams = array();
-	//if ( isset($toolbar) && $toolbar )
-		$layoutParams[] = 'toolbar=1';
-
-	if ( !empty($splitter))
-		$layoutParams[] = 'splitter=1';
-	
-	if ( isset($htmlArea) && $htmlArea ) {
-
-		$tplParams = array();
-		$tplParams['smarty_include_tpl_file'] = "../../../common/html/classic/htmlareasetup.tpl";
-		$tplParams['smarty_include_vars'] = $smarty->get_template_vars();
-
-		ob_start();
-		$smarty->_smarty_include($tplParams);
-		$result .= ob_get_clean();
-	}
-
-	$directAccess = (isset($_SESSION['HIDENAVIGATION']) && ($_SESSION['HIDENAVIGATION'] == 1)) || (isset($directAccess) && $directAccess);
-	$fullScreen = (!empty($_COOKIE["screenMode"]) && $_COOKIE["screenMode"] == "min");
-	$inplaceScreen = $smarty->get_template_vars ('inplaceScreen');
-
-	if ( $directAccess  )
-		$layoutParams[] = 'da=1';
-	
-	if ($fullScreen)
-		$layoutParams[] = 'fullscreen=1';
-	
-	if ($inplaceScreen)
-		$layoutParams[] = 'inplace=1';
-
-	if ( isset($noScroll) && $noScroll )
-		$layoutParams[] = 'ns=1';
-
-	$layoutParams = implode( "&", $layoutParams );
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/layout/$layout/setlayout.php?$layoutParams\" type=\"text/css\"/>\n";
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/layout/$layout/setlayout_ie7.php?$layoutParams\" type=\"text/css\"/><![endif]-->\n";
-	$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/layout/$layout/layout.js\"></script>\n";
-	
-	$result .= "\n<script type='text/javascript'>\n";
-	$result .= "var directAccess=" . ($directAccess ? 1 : 0) . ";\n";
-	$result .= "var inplaceScreen=" . ($inplaceScreen ? 1 : 0) . ";\n";
-	$result .= "</script>\n";
-	
-	if (!defined("LOOKANDFEEL_PREVIEW")) 
-		$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/init.js\"></script>\n";
-	else
-		$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/init_light.js\"></script>\n";
-
-	$htmlAreaIE6CSS =  isset($htmlAreaIE6CSS) ?  $htmlAreaIE6CSS : true;
-
-	if ( isset($htmlArea) && $htmlArea && $htmlAreaIE6CSS )
-		$result .= "<!--[if IE 6]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/htmlarea_ie6.css\" type=\"text/css\"/><![endif]-->\n";
-
-	// Attach the color scheme stylesheet
-	//
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/themes/common.css\" type=\"text/css\"/>\n";
-	$result .= "<link rel=\"stylesheet\" href=\"../../../common/html/cssbased/themes/$colorTheme/colors.css\" type=\"text/css\"/>\n";
-	$result .= "<!--[if IE 7]><link rel=\"stylesheet\" href=\"../../../common/html/cssbased/themes/$colorTheme/colors_ie7.css\" type=\"text/css\"/><![endif]-->\n";
-	
-	
-	
-	// Add Ext-module css
-	
-	if ($needExt) {
-		$result .= "<link rel='stylesheet' type='text/css' href='../../../common/html/res/ext/resources/css/my-ext-all.css'>";
-		$result .= "<link rel='stylesheet' type='text/css' href='../../../common/html/res/ext/resources/css/xtheme-slate.css'>";
-		$result .= "<link rel='stylesheet' type='text/css' href='../../../common/html/res/ext/resources/css/menu.css'>";
-		$result .= "<link rel='stylesheet' type='text/css' href='../../../common/html/res/ext/resources/css/layout.css'>";
-		$result .= "<script>Ext.BLANK_IMAGE_URL = '../../../common/html/res/ext/resources/images/default/s.gif'</script>";
-	}
-	
-	if (!empty($splitter)) 
-		$result .= "<script type=\"text/javascript\" src=\"../../../common/html/cssbased/splitter.js\"></script>\n";
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.wbs_statusImage.php
===================================================================
--- kernel/includes/smarty/plugins/function.wbs_statusImage.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.wbs_statusImage.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,37 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     wbs_statusImage
- * Purpose:  outputs an image indicating some status value
- * -------------------------------------------------------------
- */
-
-function smarty_function_wbs_statusImage( $params, &$this )
-{
-	extract($params);
-
-	$alignClass = null;
-	if ( isset($align) )
-		switch ( $align )
-		{
-			case "right" : $alignClass = "AlignRight"; break;
-			case "center" : $alignClass = "AlignCenter";
-		}
-
-	if ( isset($status) ) {
-		if ( $status )
-			return "<span class=\"CheckedImg $alignClass\"/>";
-		else
-			return "<span class=\"UnCheckedImg $alignClass\"/>";
-	} else {
-		if ( $value  == $onValue )
-			return "<span class=\"CheckedImg $alignClass\"/>";
-		else
-			return "<span class=\"UnCheckedImg $alignClass\"/>";
-	}
-}
-
-?>
Index: kernel/includes/smarty/plugins/function.wbs_thumbnail.php
===================================================================
--- kernel/includes/smarty/plugins/function.wbs_thumbnail.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.wbs_thumbnail.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,54 +0,0 @@
-<?php
-
-/*
- * WebAsyst Smarty Plugin
- * -------------------------------------------------------------
- * Type:     function
- * Name:     wbs_thumbnail
- * Purpose:  Outputs the image thumbnail
- * -------------------------------------------------------------
- */
-
-function smarty_function_wbs_thumbnail( $params, &$smarty )
-{
-	$id = isset($params['id']) ? "id=\"{$params['id']}\"" : null;
-
-	$result = "<div class=\"Thumbnail\">\n";
-	$result .= "<div>\n";
-	$result .= "<div>\n";
-
-	$anchor = null;
-
-	if ( $params['URL'] ) {
-		$url = $params['URL'];
-
-		$target = $params['target'];
-		if ( $target )
-			$target = "target=\"$target\"";
-		
-		$onClickStr = (@$params["onClick"]) ? "onClick=\"" . $params["onClick"] . "\"" : "";
-
-		$anchor = "<a $onClickStr href=\"$url\" $target>";
-	}
-
-	if ( isset($params['src']) ) {
-		$src = $params['src'];
-		$title = $params['title'];
-		$result .= "<table><tr><td valign=\"middle\">\n";
-		$result .= "$anchor<img $id valign=\"middle\" src=\"$src\" title=\"$title\"/>\n";
-		if ( $anchor !== null )
-			$result .= "</a>";
-		$result .= "</td></tr></table>\n";
-	} else {
-		$kernelStrings = $smarty->get_template_vars('kernelStrings');
-		$result .= '<span>['.$kernelStrings['app_noimage_label'].']</span>';
-	}
-
-	$result .= "</div>\n";
-	$result .= "</div>\n";
-	$result .= "</div>\n";
-
-	return $result;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/function.z_shopping_count.php
===================================================================
--- kernel/includes/smarty/plugins/function.z_shopping_count.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/function.z_shopping_count.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,37 +0,0 @@
-<?php
-
-	function smarty_function_z_shopping_count($params, &$smarty) {
-
-		if(isset($params['productID'])) {	
-			$productID = $params['productID'];
-			$count = get_shop_cout($productID);
-			return $count;
-		} else {
-			return '0';
-		}
-	}
-
-	function get_shop_cout($productID) {
-
-		$customerID = isset($_SESSION['cs_id'])?$_SESSION['cs_id']:'';
-		
-		if ($customerID) {
-            $query = '
-                      SELECT
-                          a.Quantity
-                      FROM
-                          SC_shopping_carts a,
-                          SC_shopping_cart_items b
-                      WHERE
-                          a.customerID = '.$customerID.'
-                          AND
-                          a.itemID = b.itemID
-                          AND
-                          b.productID = '.$productID
-            ;
-            $count = (int)mysql_fetch_object(mysql_query($query))->Quantity;
-            return $count;
-		} else {
-				return '';
-		}
-	}
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.callfunc.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.callfunc.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.callfunc.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,26 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty callfunc modifier plugin
- *
- * Type:     modifier<br>
- * Name:     callfunc<br>
- * Date:     Feb 24, 2003
- * Purpose:  Handle variable by function
- * Input:    string function name
- * Example:  {$var|callfunc:"base64_encode"}
- */
-function smarty_modifier_callfunc($Value, $Function){
-
-	return call_user_func_array($Function, array($Value));
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.comment.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.comment.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.comment.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,23 +0,0 @@
-<?php
-function smarty_modifier_comment($value, $comment_id = ''){
-
-	if(!$comment_id)$comment_id = $value;
-	
-	$user_login = '';
-	$user_login = sc_getSessionData('U_ID');
-	$comment_id = "cmnt-{$user_login}-{$comment_id}";
-	if(isset($_COOKIE[$comment_id])||!$value){
-		setcookie($comment_id, 1, 60*24*60*60);
-		return '';
-	}
-	$value = translate($value);
-	return 
-"
-<p class='comment_block' id='{$comment_id}'>
-{$value}
-<br /><br />
-<a href='#close_comment' onclick='closeComment(\"{$comment_id}\");'>".translate('btn_close')."</a>
-</p>
-";
-}
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.count.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.count.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.count.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,16 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     modifier
- * Name:     count
- * Purpose:  Returns the number of elements in var
- * -------------------------------------------------------------
- */
-function smarty_modifier_count($value)
-{
-	return $value;
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.cs_load_auxpage.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.cs_load_auxpage.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.cs_load_auxpage.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,25 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     modifier
- * Name:     basename
- * Purpose:  see basename() in php manual
- * -------------------------------------------------------------
- */
-function smarty_modifier_cs_load_auxpage($slug)
-{
-  $query = "SELECT aux_page_text_ru as text_ru, aux_page_name_ru FROM SC_aux_pages WHERE aux_page_slug = '$slug'";
-  $res   = mysql_query($query) or die(mysql_error()."<br>$query");
-  $row=mysql_fetch_object($res);
-  if ($row)
-  {
-    $sotr_text = "<B>$row->aux_page_name_ru</B><br> $row->text_ru";
-  } else $sotr_text = 'Для вставки здесь текста добавьте информационную страницу с id = '.$slug;
-  return $sotr_text;
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.cs_subcategory_char.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.cs_subcategory_char.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.cs_subcategory_char.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,38 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty strip modifier plugin
- *
- * Type:     modifier<br>
- * Name:     strip<br>
- * Purpose:  Replace all repeated spaces, newlines, tabs
- *           with a single space or supplied replacement string.<br>
- * Example:  {$var|strip} {$var|strip:"&nbsp;"}
- * Date:     September 25th, 2002
- * @link http://smarty.php.net/manual/en/language.modifier.strip.php
- *          strip (Smarty online manual)
- * @author   Monte Ohrt <monte at ohrt dot com>
- * @version  1.0
- * @param string
- * @param string
- * @return string
- */
-function smarty_modifier_cs_subcategory_char($text)
-{
-  $query = "SELECT count(categoryID) as c FROM SC_categories WHERE parent = '$text'";
-  $count = mysql_fetch_object(mysql_query($query))->c;
-  if ($count)
-  {
-    return '&nbsp;+';
-  } else return '&nbsp;';
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.currency.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.currency.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.currency.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,32 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty currency modifier plugin
- *
- * Type:     modifier<br>
- * Name:    currency<br>
- * Date:     Feb 24, 2003
- * Purpose:  print amount in currency display template. If currency iso3 is empty use current selected currency
- * Input:    string currency iso3 code 
- * Example:  {$var|currency:"USD"}
- */
-function smarty_modifier_currency($amount, $currency_iso_3){
-
-	if(!$currency_iso_3){
-		global $selected_currency_details;
-		$currency = $selected_currency_details;
-	}else{
-		$currency = currGetCurrencyByISO3($currency_iso_3);
-	}
-	return sprintf($currency['display_template'], $amount);
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.escape.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.escape.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.escape.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,89 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty escape modifier plugin
- *
- * Type:     modifier<br>
- * Name:     escape<br>
- * Purpose:  Escape the string according to escapement type
- * @link http://smarty.php.net/manual/en/language.modifier.escape.php
- *          escape (Smarty online manual)
- * @param string
- * @param html|htmlall|url|quotes|hex|hexentity|javascript
- * @return string
- */
-function smarty_modifier_escape($string, $esc_type = 'html')
-{
-    switch ($esc_type) {
-        case 'html':
-            return htmlspecialchars($string, ENT_QUOTES);
-
-        case 'htmlall':
-            return htmlentities($string, ENT_QUOTES);
-
-        case 'url':
-            return rawurlencode($string);
-
-        case 'quotes':
-            // escape unescaped single quotes
-            return preg_replace("%(?<!\\\\)'%", "\\'", $string);
-
-        case 'hex':
-            // escape every character into hex
-            $return = '';
-            for ($x=0; $x < strlen($string); $x++) {
-                $return .= '%' . bin2hex($string[$x]);
-            }
-            return $return;
-            
-        case 'hexentity':
-            $return = '';
-            for ($x=0; $x < strlen($string); $x++) {
-                $return .= '&#x' . bin2hex($string[$x]) . ';';
-            }
-            return $return;
-
-        case 'decentity':
-            $return = '';
-            for ($x=0; $x < strlen($string); $x++) {
-                $return .= '&#' . ord($string[$x]) . ';';
-            }
-            return $return;
-
-        case 'javascript':
-            // escape quotes and backslashes, newlines, etc.
-            return strtr($string, array('\\'=>'\\\\',"'"=>"\\'",'"'=>'\\"',"\r"=>'\\r',"\n"=>'\\n','</'=>'<\/'));
-            
-        case 'mail':
-            // safe way to display e-mail address on a web page
-            return str_replace(array('@', '.'),array(' [AT] ', ' [DOT] '), $string);
-            
-        case 'nonstd':
-           // escape non-standard chars, such as ms document quotes
-           $_res = '';
-           for($_i = 0, $_len = strlen($string); $_i < $_len; $_i++) {
-               $_ord = ord($string{$_i});
-               // non-standard char, escape it
-               if($_ord >= 126){
-                   $_res .= '&#' . $_ord . ';';
-               }
-               else {
-                   $_res .= $string{$_i};
-               }
-           }
-           return $_res;
-
-        default:
-            return $string;
-    }
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.is_zakaz_product.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.is_zakaz_product.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.is_zakaz_product.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,16 +0,0 @@
-<?php
-
-function smarty_modifier_is_zakaz_product($productID)
-{
-  $query = "
-SELECT count(*)  FROM SC_product_list_item
-WHERE list_id = 'zakaz' AND productID = '".$productID."' ";
-
-  $res   = mysql_query($query) or die(mysql_error()."<br>$query");
-  $row = mysql_fetch_row($res);
-  return intval($row[0]);
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.isauthpage.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.isauthpage.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.isauthpage.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,36 +0,0 @@
-<?php
-
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * Type:     modifier
- * Name:     basename
- * Purpose:  see basename() in php manual
- * -------------------------------------------------------------
- */
-function smarty_modifier_isauthpage($string)
-{
-    $enabled = array('auxpage_1',
-                     'auxpage_2',
-                     'auxpage_programka-shtrih-kod',
-                     'auxpage_preimushestva',
-                     'news',
-                     'auxpage_cash-carry',
-                     'auxpage_zamena-braka',
-                     'register',
-                     'feedback',
-                     'auth',
-                     'successful_registration',
-                     'office',
-                     'contact_info',
-                     'address_book',
-                     'order_history',
-                     'add_address',
-                     'address_editor');
-
-    return in_array($string, $enabled) || (substr($string,0,8)=='auxpage_');
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.spacify.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.spacify.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.spacify.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,29 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty spacify modifier plugin
- *
- * Type:     modifier<br>
- * Name:     spacify<br>
- * Purpose:  add spaces between characters in a string
- * @link http://smarty.php.net/manual/en/language.modifier.spacify.php
- *          spacify (Smarty online manual)
- * @param string
- * @param string
- * @return string
- */
-function smarty_modifier_spacify($string, $spacify_char = ' ')
-{
-    return implode($spacify_char,
-                   preg_split('//', $string, -1, PREG_SPLIT_NO_EMPTY));
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.string_format.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.string_format.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.string_format.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,28 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty string_format modifier plugin
- *
- * Type:     modifier<br>
- * Name:     string_format<br>
- * Purpose:  format strings via sprintf
- * @link http://smarty.php.net/manual/en/language.modifier.string.format.php
- *          string_format (Smarty online manual)
- * @param string
- * @param string
- * @return string
- */
-function smarty_modifier_string_format($string, $format)
-{
-    return sprintf($format, $string);
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.strip_tags.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.strip_tags.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.strip_tags.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,31 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty strip_tags modifier plugin
- *
- * Type:     modifier<br>
- * Name:     strip_tags<br>
- * Purpose:  strip html tags from text
- * @link http://smarty.php.net/manual/en/language.modifier.strip.tags.php
- *          strip_tags (Smarty online manual)
- * @param string
- * @param boolean
- * @return string
- */
-function smarty_modifier_strip_tags($string, $replace_with_space = true)
-{
-    if ($replace_with_space)
-        return preg_replace('!<[^>]*?>!', ' ', $string);
-    else
-        return strip_tags($string);
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.strpos.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.strpos.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.strpos.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,8 +0,0 @@
-<?php
-
-function smarty_modifier_strpos($str1, $str2)
-{
-    return (strpos($str1, $str2) !== false); 
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.usd.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.usd.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.usd.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,55 +0,0 @@
-<?php
-/* function smarty_modifier_usd($log) */
-/* {
-  $query = "
-SELECT  skidka  FROM SC_customers
-WHERE  Login = '$log' ";
-
-  $res   = mysql_query($query) or die(mysql_error()."<br>$query");
-  $row = mysql_fetch_row($res);
-  return $row[0];
-} */
-function smarty_modifier_usd($log){
-
-if(isset($_SESSION["log"])) $log = $_SESSION["log"];
-  else return 0;
-  // GetCustomer
-  $query = "SELECT * FROM SC_customers WHERE Login='".$log."'";
-  $Customer=mysql_fetch_object(mysql_query($query));
-  $usd2=$Customer->vip;
-  
-  
-  switch ($usd2) {
-    case 1:
-        $query = "SELECT * FROM SC_currency_types WHERE CID=11";
-        break;
-    case 2:
-        $query = "SELECT * FROM SC_currency_types WHERE CID=12";
-        break;
-    case 3:
-        $query = "SELECT * FROM SC_currency_types WHERE CID=13";
-        break;
-    case 4:
-        $query = "SELECT * FROM SC_currency_types WHERE CID=14";
-        break;
-	 default:
-		  $query = "SELECT * FROM SC_currency_types WHERE CID=10";
-}
-
-  // if ($usd2){
-  // $query = "SELECT * FROM SC_currency_types WHERE CID=10";}
-  // else{
-  // $query = "SELECT * FROM SC_currency_types WHERE CID=11";}
-  
-  $currency=mysql_fetch_object(mysql_query($query));
-
-  $usd = $currency->currency_value;
-  $usd = 1/$usd;
-  $usd = number_format($usd, 2);
-
-	return $usd;
-}
-
-
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.welcome.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.welcome.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.welcome.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,24 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-function smarty_modifier_welcome($log)
-{
-   $hour = (int)strftime('%H');
-	$welcome = '';
-	if ($hour > 0 and $hour < 6)
-		$welcome = 'Доброй ночи';
-	elseif ($hour >= 6 and $hour < 12)
-		$welcome = 'Доброе утро';
-	elseif ($hour >= 12 and $hour < 18)
-		$welcome = 'Добрый день';
-	elseif ($hour >= 18 and $hour < 23)
-		$welcome = 'Добрый вечер';
-	else
-		$welcome = 'Доброй ночи';
-	//echo $welcome;
-   return $welcome;
-    }
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/modifier.wordwrap.php
===================================================================
--- kernel/includes/smarty/plugins/modifier.wordwrap.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/modifier.wordwrap.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,28 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * Smarty wordwrap modifier plugin
- *
- * Type:     modifier<br>
- * Name:     wordwrap<br>
- * Purpose:  wrap a string of text at a given length
- * @link http://smarty.php.net/manual/en/language.modifier.wordwrap.php
- *          wordwrap (Smarty online manual)
- * @param string
- * @param integer
- * @param string
- * @param boolean
- * @return string
- */
-function smarty_modifier_wordwrap($string,$length=80,$break="\n",$cut=false)
-{
-    return wordwrap($string,$length,$break,$cut);
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/outputfilter.trimwhitespace.php
===================================================================
--- kernel/includes/smarty/plugins/outputfilter.trimwhitespace.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/outputfilter.trimwhitespace.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,75 +0,0 @@
-<?php
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-/**
- * Smarty trimwhitespace outputfilter plugin
- *
- * File:     outputfilter.trimwhitespace.php<br>
- * Type:     outputfilter<br>
- * Name:     trimwhitespace<br>
- * Date:     Jan 25, 2003<br>
- * Purpose:  trim leading white space and blank lines from
- *           template source after it gets interpreted, cleaning
- *           up code and saving bandwidth. Does not affect
- *           <<PRE>></PRE> and <SCRIPT></SCRIPT> blocks.<br>
- * Install:  Drop into the plugin directory, call
- *           <code>$smarty->load_filter('output','trimwhitespace');</code>
- *           from application.
- * @author   Monte Ohrt <monte at ohrt dot com>
- * @author Contributions from Lars Noschinski <lars@usenet.noschinski.de>
- * @version  1.3
- * @param string
- * @param Smarty
- */
-function smarty_outputfilter_trimwhitespace($source, &$smarty)
-{
-    // Pull out the script blocks
-    preg_match_all("!<script[^>]+>.*?</script>!is", $source, $match);
-    $_script_blocks = $match[0];
-    $source = preg_replace("!<script[^>]+>.*?</script>!is",
-                           '@@@SMARTY:TRIM:SCRIPT@@@', $source);
-
-    // Pull out the pre blocks
-    preg_match_all("!<pre>.*?</pre>!is", $source, $match);
-    $_pre_blocks = $match[0];
-    $source = preg_replace("!<pre>.*?</pre>!is",
-                           '@@@SMARTY:TRIM:PRE@@@', $source);
-
-    // Pull out the textarea blocks
-    preg_match_all("!<textarea[^>]+>.*?</textarea>!is", $source, $match);
-    $_textarea_blocks = $match[0];
-    $source = preg_replace("!<textarea[^>]+>.*?</textarea>!is",
-                           '@@@SMARTY:TRIM:TEXTAREA@@@', $source);
-
-    // remove all leading spaces, tabs and carriage returns NOT
-    // preceeded by a php close tag.
-    $source = trim(preg_replace('/((?<!\?>)\n)[\s]+/m', '\1', $source));
-
-    // replace script blocks
-    smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:SCRIPT@@@",$_script_blocks, $source);
-
-    // replace pre blocks
-    smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:PRE@@@",$_pre_blocks, $source);
-
-    // replace textarea blocks
-    smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:TEXTAREA@@@",$_textarea_blocks, $source);
-
-    return $source;
-}
-
-function smarty_outputfilter_trimwhitespace_replace($search_str, $replace, &$subject) {
-    $_len = strlen($search_str);
-    $_pos = 0;
-    for ($_i=0, $_count=count($replace); $_i<$_count; $_i++)
-        if (($_pos=strpos($subject, $search_str, $_pos))!==false)
-            $subject = substr_replace($subject, $replace[$_i], $_pos, $_len);
-        else
-            break;
-
-}
-
-?>
\ No newline at end of file
Index: kernel/includes/smarty/plugins/shared.escape_special_chars.php
===================================================================
--- kernel/includes/smarty/plugins/shared.escape_special_chars.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
+++ kernel/includes/smarty/plugins/shared.escape_special_chars.php	(revision 7c2dd21f492a3054d01cd66a332a95014f32ebeb)
@@ -1,30 +0,0 @@
-<?php
-/**
- * Smarty shared plugin
- * @package Smarty
- * @subpackage plugins
- */
-
-
-/**
- * escape_special_chars common function
- *
- * Function: smarty_function_escape_special_chars<br>
- * Purpose:  used by other smarty functions to escape
- *           special chars except for already escaped ones
- * @param string
- * @return string
- */
-function smarty_function_escape_special_chars($string)
-{
-    if(!is_array($string)) {
-        $string = preg_replace('!&(#?\w+);!', '%%%SMARTY_START%%%\\1%%%SMARTY_END%%%', $string);
-        $string = htmlspecialchars($string);
-        $string = str_replace(array('%%%SMARTY_START%%%','%%%SMARTY_END%%%'), array('&',';'), $string);
-    }
-    return $string;
-}
-
-/* vim: set expandtab: */
-
-?>
\ No newline at end of file
